{
  "builders": [
    {
      "type": "hyperv-iso",
      "boot_command": [ "aaaaa<wait>a<wait>a<wait>" ],
      "boot_wait": "0s",
      "communicator": "winrm",
      "cpu": 4,
      "disk_size": 122880,
      "enable_secure_boot": true,
      "floppy_files": [],
      "generation": 2,
      "iso_url": "{{user `iso_url`}}",
      "iso_checksum": "{{user `iso_checksum`}}",
      "iso_checksum_type": "{{user `iso_checksum_type`}}",
      "ram_size": 4096,
      "secondary_iso_images": [ "./configuration/iso-scripts/answer.iso" ],
      "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
      "switch_name": "Default Switch",
      "vm_name": "DARKSURGEON_w10_1803_x64",
      "winrm_timeout": "60m",
      "winrm_username": "darksurgeon",
      "winrm_password": "darksurgeon",
      "winrm_use_ntlm": "true"
    },
    {
      "type": "virtualbox-iso",
      "boot_command": [ "aaaaa<wait>a<wait>a<wait>" ],
      "boot_wait": "0s",
      "communicator": "winrm",
      "iso_url": "{{user `iso_url`}}",
      "iso_checksum": "{{user `iso_checksum`}}",
      "iso_checksum_type": "{{user `iso_checksum_type`}}",
      "headless": true,      
      "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
      "guest_os_type": "Windows2012_64",
      "guest_additions_mode": "disable",
      "disk_size": 122880,
      "floppy_dirs": [ "./configuration/iso-scripts/" ],
      "winrm_timeout": "60m",
      "winrm_username": "darksurgeon",
      "winrm_password": "darksurgeon",
      "vboxmanage": [
        [
          "modifyvm",
          "{{.Name}}",
          "--memory",
          "4096"
        ],
        [
          "modifyvm",
          "{{.Name}}",
          "--cpus",
          "4"
        ]
      ]
    },
    {
      "type": "vmware-iso",
      "communicator": "winrm",
      "iso_url": "{{user `iso_url`}}",
      "iso_checksum_type": "{{user `iso_checksum_type`}}",
      "iso_checksum": "{{user `iso_checksum`}}",
      "headless": true,
      "boot_wait": "0s",
      "winrm_username": "darksurgeon",
      "winrm_password": "darksurgeon",
      "winrm_timeout": "60m",
      "shutdown_timeout": "2h",
      "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
      "guest_os_type": "windows8srv-64",
      "disk_size": 61440,
      "vnc_port_min": 5900,
      "vnc_port_max": 5980,
      "version": 11,
      "floppy_dirs": [ "./configuration/iso-scripts/" ],
      "vmx_data": {
        "RemoteDisplay.vnc.enabled": "false",
        "RemoteDisplay.vnc.port": "5900",
        "memsize": "4096",
        "numvcpus": "4",
        "scsi0.virtualDev": "lsisas1068"
      }
  }],
  "provisioners": [
    {
      "type": "file",
      "source": "./configuration/helper-scripts/",
      "destination": "C:\\windows\\Temp\\",
      "direction": "upload"
    },
    {
      "type": "file",
      "source": "./configuration/configuration-files/",
      "destination": "C:\\packer\\",
      "direction": "upload"
    },
    {
      "type": "powershell",
      "elevated_user": "darksurgeon",
      "elevated_password": "darksurgeon",
      "scripts": [
	"./configuration/configuration-scripts/Set-DataExecutionPrevention.ps1",
        "./configuration/configuration-scripts/Set-PowerSettings.ps1",
        "./configuration/configuration-scripts/Set-LowSecurityWindowsDefenderAntiVirusSettings.ps1",
        "./configuration/configuration-scripts/Set-LowSecurityWindowsDefenderSmartScreenSettings.ps1",
        "./configuration/configuration-scripts/Set-LowSecurityWindowsDefenderExploitGuardSettings.ps1",
        "./configuration/configuration-scripts/Set-WindowsTelemetrySettings.ps1",
        "./configuration/configuration-scripts/Remove-PreInstalledApps.ps1",
        "./configuration/configuration-scripts/Install-Chocolatey.ps1",
        "./configuration/configuration-scripts/Set-ChocolateySettings.ps1",
        "./configuration/configuration-scripts/Set-ChocolateyFLARERepo.ps1",
        "./configuration/configuration-scripts/Install-Boxstarter.ps1",
        "./configuration/configuration-scripts/Install-WSL.ps1",
        "./configuration/configuration-scripts/Install-DotNet4.ps1",
        "./configuration/configuration-scripts/Install-VCRedistAll.ps1",
        "./configuration/configuration-scripts/Install-Nuget.ps1",
        "./configuration/configuration-scripts/Install-Python2.ps1",
        "./configuration/configuration-scripts/Install-VCPython27.ps1",
        "./configuration/configuration-scripts/Install-PIPCryptography.ps1",
        "./configuration/configuration-scripts/Install-PIPHexdump.ps1",
        "./configuration/configuration-scripts/Install-PIPJupyter.ps1",
        "./configuration/configuration-scripts/Install-PIPOLETools.ps1",
        "./configuration/configuration-scripts/Install-PIPPandas.ps1",
        "./configuration/configuration-scripts/Install-PIPPassivetotal.ps1",
        "./configuration/configuration-scripts/Install-PIPPEFile.ps1",
        "./configuration/configuration-scripts/Install-PIPPyCryptodome.ps1",
        "./configuration/configuration-scripts/Install-PIPScapy.ps1",
        "./configuration/configuration-scripts/Install-PIPShodan.ps1",
        "./configuration/configuration-scripts/Install-PIPSigma.ps1",
        "./configuration/configuration-scripts/Install-PIPWinAppDBG.ps1",
        "./configuration/configuration-scripts/Install-PIPYaraPython.ps1",
        "./configuration/configuration-scripts/Install-FLAREVivisect.ps1",
        "./configuration/configuration-scripts/Install-1Password.ps1",
        "./configuration/configuration-scripts/Install-7Zip.ps1",
        "./configuration/configuration-scripts/Install-AdobeFlashPlayer.ps1",
        "./configuration/configuration-scripts/Install-AdobeReader.ps1",
        "./configuration/configuration-scripts/Install-AWSCLI.ps1",
        "./configuration/configuration-scripts/Install-Bleachbit.ps1",
        "./configuration/configuration-scripts/Install-BurpFree.ps1",
        "./configuration/configuration-scripts/Install-Checksum.ps1",
        "./configuration/configuration-scripts/Install-Cmder.ps1",
        "./configuration/configuration-scripts/Install-Curl.ps1",
        "./configuration/configuration-scripts/Install-Docker.ps1",
        "./configuration/configuration-scripts/Install-DEX2JAR.ps1",
        "./configuration/configuration-scripts/Install-Exiftool.ps1",
        "./configuration/configuration-scripts/Install-FLARE010Editor.ps1",
        "./configuration/configuration-scripts/Install-FLAREAPIMonitor.ps1",
        "./configuration/configuration-scripts/Install-FLAREAPKTool.ps1",
        "./configuration/configuration-scripts/Install-FLAREBinaryNinja.ps1",
        "./configuration/configuration-scripts/Install-FLARECyberchef.ps1",
        "./configuration/configuration-scripts/Install-FLAREDE4Dot.ps1",
        "./configuration/configuration-scripts/Install-FLAREDIE.ps1",
        "./configuration/configuration-scripts/Install-FLAREDotPeek.ps1",
        "./configuration/configuration-scripts/Install-FLAREEXEInfoPE.ps1",
        "./configuration/configuration-scripts/Install-FLAREExplorerSuite.ps1",
        "./configuration/configuration-scripts/Install-FLAREFakeNetNG.ps1",
        "./configuration/configuration-scripts/Install-FLAREFileInsight.ps1",
        "./configuration/configuration-scripts/Install-FLAREFLOSS.ps1",
        "./configuration/configuration-scripts/Install-FLAREHashCalc.ps1",
        "./configuration/configuration-scripts/Install-FLAREHXD.ps1",
        "./configuration/configuration-scripts/Install-FLAREIDAFree.ps1",
        "./configuration/configuration-scripts/Install-FLAREIDR.ps1",
        "./configuration/configuration-scripts/Install-FLAREILSpy.ps1",
        "./configuration/configuration-scripts/Install-FLAREJDGUI.ps1",
        "./configuration/configuration-scripts/Install-FLAREMAP.ps1",
        "./configuration/configuration-scripts/Install-FLAREOfficeMalScanner.ps1",
        "./configuration/configuration-scripts/Install-FLAREOffVis.ps1",
        "./configuration/configuration-scripts/Install-FLAREOllydbg.ps1",
        "./configuration/configuration-scripts/Install-FLAREOllydbg2.ps1",
        "./configuration/configuration-scripts/Install-FLAREPDFID.ps1",
        "./configuration/configuration-scripts/Install-FLAREPDFParser.ps1",
        "./configuration/configuration-scripts/Install-FLAREPDFStreamDumper.ps1",
        "./configuration/configuration-scripts/Install-FLAREPEID.ps1",
        "./configuration/configuration-scripts/Install-FLAREPEStudio.ps1",
        "./configuration/configuration-scripts/Install-FLAREPEView.ps1",
        "./configuration/configuration-scripts/Install-FLAREPMALabs.ps1",
        "./configuration/configuration-scripts/Install-FLAREProcessHacker.ps1",
        "./configuration/configuration-scripts/Install-FLARERadare2.ps1",
        "./configuration/configuration-scripts/Install-FLARERegShot.ps1",
        "./configuration/configuration-scripts/Install-FLAREResourceHacker.ps1",
        "./configuration/configuration-scripts/Install-FLAREShellcodeLauncher.ps1",
        "./configuration/configuration-scripts/Install-FLARESpyStudio.ps1",
        "./configuration/configuration-scripts/Install-FLARESysanalyzer.ps1",
        "./configuration/configuration-scripts/Install-FLAREVBDecompilerLite.ps1",
        "./configuration/configuration-scripts/Install-FLAREWindbg.ps1",
        "./configuration/configuration-scripts/Install-FLAREWireshark.ps1",
        "./configuration/configuration-scripts/Install-FLAREx64dbg.ps1",
        "./configuration/configuration-scripts/Install-FLAREXorsearch.ps1",
        "./configuration/configuration-scripts/Install-FLAREXorstrings.ps1",
        "./configuration/configuration-scripts/Install-FLAREYARA.ps1",
        "./configuration/configuration-scripts/Install-Git.ps1",
        "./configuration/configuration-scripts/Install-Golang.ps1",
        "./configuration/configuration-scripts/Install-GoogleChrome.ps1",
        "./configuration/configuration-scripts/Install-GPG4Win.ps1",
        "./configuration/configuration-scripts/Install-Hashdeep.ps1",
        "./configuration/configuration-scripts/Install-Hasher.ps1",
        "./configuration/configuration-scripts/Install-Hashtab.ps1",
        "./configuration/configuration-scripts/Install-IISGeolocate.ps1",
        "./configuration/configuration-scripts/Install-InvokeATTACKAPI.ps1",
        "./configuration/configuration-scripts/Install-Irfanview.ps1",
        "./configuration/configuration-scripts/Install-JavaJDK8.ps1",
        "./configuration/configuration-scripts/Install-JavaJRE8.ps1",
        "./configuration/configuration-scripts/Install-JLECmd.ps1",
        "./configuration/configuration-scripts/Install-JQ.ps1",
        "./configuration/configuration-scripts/Install-JumpListExplorer.ps1",
        "./configuration/configuration-scripts/Install-Keepass.ps1",
        "./configuration/configuration-scripts/Install-LECmd.ps1",
        "./configuration/configuration-scripts/Install-LOLBAS.ps1",
        "./configuration/configuration-scripts/Install-MozillaFirefox.ps1",
        "./configuration/configuration-scripts/Install-MozillaThunderbird.ps1",
        "./configuration/configuration-scripts/Install-Neo4jCommunity.ps1",
        "./configuration/configuration-scripts/Install-Nmap.ps1",
        "./configuration/configuration-scripts/Install-NodeJS.ps1",
        "./configuration/configuration-scripts/Install-Office365ProPlus.ps1",
        "./configuration/configuration-scripts/Install-OpenSSH.ps1",
        "./configuration/configuration-scripts/Install-Osquery.ps1",
        "./configuration/configuration-scripts/Install-PECmd.ps1",
        "./configuration/configuration-scripts/Install-PSAttack.ps1",
        "./configuration/configuration-scripts/Install-PSMAutoRuns.ps1",
        "./configuration/configuration-scripts/Install-PSMAzurePowershell.ps1",
        "./configuration/configuration-scripts/Install-PSMCimSweep.ps1",
        "./configuration/configuration-scripts/Install-PSMPester.ps1",
        "./configuration/configuration-scripts/Install-PSMPoshGit.ps1",
        "./configuration/configuration-scripts/Install-PSMPoshSecMod.ps1",
        "./configuration/configuration-scripts/Install-PSMPoshSysmon.ps1",
        "./configuration/configuration-scripts/Install-PSMPowerForensics.ps1",
        "./configuration/configuration-scripts/Install-PSMPowerSploit.ps1",
        "./configuration/configuration-scripts/Install-PSMRevokeObfuscation.ps1",
        "./configuration/configuration-scripts/Install-Putty.ps1",
        "./configuration/configuration-scripts/Install-Qbittorrent.ps1",
        "./configuration/configuration-scripts/Install-RawCap.ps1",
        "./configuration/configuration-scripts/Install-RegistryExplorer.ps1",
        "./configuration/configuration-scripts/Install-RTA.ps1",
        "./configuration/configuration-scripts/Install-ShellbagsExplorer.ps1",
        "./configuration/configuration-scripts/Install-Slack.ps1",
        "./configuration/configuration-scripts/Install-Sleuthkit.ps1",
        "./configuration/configuration-scripts/Install-SublimeText3.ps1",
        "./configuration/configuration-scripts/Install-Sysinternals.ps1",
        "./configuration/configuration-scripts/Install-TimeApp.ps1",
        "./configuration/configuration-scripts/Install-TimelineExplorer.ps1",
        "./configuration/configuration-scripts/Install-TorBrowser.ps1",
        "./configuration/configuration-scripts/Install-UnxUtils.ps1",
        "./configuration/configuration-scripts/Install-UPX.ps1",
        "./configuration/configuration-scripts/Install-VirusTotalUploader.ps1",
        "./configuration/configuration-scripts/Install-VisualStudioCode.ps1",
        "./configuration/configuration-scripts/Install-Volatility.ps1",
        "./configuration/configuration-scripts/Install-Wget.ps1",
        "./configuration/configuration-scripts/Install-WindowsSDK10.ps1",
        "./configuration/configuration-scripts/Install-Winlogbeat.ps1",
        "./configuration/configuration-scripts/Install-XWFIM.ps1"
      ]
    },
    {
      "type": "windows-restart",
      "restart_timeout": "15m"
    },
    {
      "type": "powershell",
      "elevated_user": "darksurgeon",
      "elevated_password": "darksurgeon",
      "scripts": [
        "./configuration/configuration-scripts/Install-NetCease.ps1",
        "./configuration/configuration-scripts/Remove-SMBv1.ps1",
        "./configuration/configuration-scripts/Remove-WPAD.ps1",
        "./configuration/configuration-scripts/Remove-LLMNR.ps1",
        "./configuration/configuration-scripts/Remove-NBT.ps1",
        "./configuration/configuration-scripts/Set-WindowsEventAuditSettings.ps1",
        "./configuration/configuration-scripts/Set-PowershellLoggingSettings.ps1",
        "./configuration/configuration-scripts/Install-Sysmon.ps1",
        "./configuration/configuration-scripts/Set-SysmonSettings.ps1",
        "./configuration/configuration-scripts/Set-DARKSURGEONTheme.ps1",
        "./configuration/configuration-scripts/Invoke-SystemUpdate.ps1",      
        "./configuration/configuration-scripts/Invoke-SystemCleanup.ps1"
      ]
    },    
    {
      "type": "windows-restart",
      "restart_timeout": "15m"
    }
  ],
  "post-processors": [
    {
      "type": "vagrant",
      "keep_input_artifact": false,
      "output": "DARKSURGEON_w10_1803_x64_{{.Provider}}.box",
      "vagrantfile_template": "vagrantfile_DARKSURGEON_w10_1803_x64.template"
    }
  ],
  "variables": {
    "iso_url": "windows-10-1803-x64-enterprise.iso",
    "iso_checksum_type": "sha1",
    "iso_checksum": "28681742FE850AA4BFC7075811C5244B61D462CF"
  }
}
